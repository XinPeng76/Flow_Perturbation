# Flow_Perturbation
We introduce the flow perturbation method, which incorporates optimized stochastic perturbations into the flow. By reweighting trajectories generated by the perturbed flow, our method achieves
unbiased sampling of the Boltzmann distribution with orders of magnitude speedup compared to both brute force
Jacobian calculations and the Hutchinson estimator. 

![Flow Perturbation](./data/ODE_pf.pdf "Title")

Publication
-----------
Please find the arxiv preprint here:
[https://arxiv.org/abs/2002.06707](https://arxiv.org/abs/2407.10666)

Citation update is coming up...
```
@article{peng2024flow,
  title={Flow Perturbation to Accelerate Unbiased Sampling of Boltzmann distribution},
  author={Peng, Xin and Gao, Ang},
  journal={arXiv preprint arXiv:2407.10666},
  year={2024}
}
```
***
## [Dependencies](#dependencies)
* Mandatory
  * [pytorch>=2.0](https://github.com/pytorch/pytorch)
  * [numpy](https://github.com/numpy/numpy)
  * [bgmol](https://github.com/noegroup/bgmol) (for  Chignolin)
  * [bgflow](https://github.com/noegroup/bgmol) (for  Chignolin)
  * [mdtraj](https://github.com/mdtraj/mdtraj) (for  Chignolin)

# Examples
* Use the example in the paper
```
Flow_Perturbation
|___GMM # Gaussian Mixture Model
|   |___train_model_GMM.py # Train the Flow model
|   |__train_Var_GMM.py # Train the Flow Perturbation var model
|   |___GMM_FP.py # Flow Perturbation
|   |___GMM_H1.py # Hutchinson estimator
|   |___GMM_H10.py # 10 Hutchinson estimator
|   |___GMM_J.py # Jacobian
|   
|___Chignolin
|   |___train_model_CGN.py # Train the Flow model
|   |__train_Var_CGN.py # Train the Flow Perturbation var model
|   |___CGN_FP.py # Flow Perturbation
|   |___CGN_H1.py # Hutchinson estimator
|   |___CGN_H10.py # 10 Hutchinson estimator
|   |___CGN_J.py # Jacobian
|   
...
```
* Use the example in jupyter notebook
  * [snf](https://github.com/noegroup/stochastic_normalizing_flows)
```
image_dog.ipynb
image_dog_DDPm.ipynb
GMM_50D.ipynb
GMM50D_DDPM.ipynb
```
***
## [License](#dependencies)
[MIT License](LICENSE)
